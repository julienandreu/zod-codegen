// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
// Built with zod-codegen@0.1.0-alpha.1
// Latest edit: Sat, 23 Dec 2023 19:54:12 GMT
// Source file: ./samples/swagger-petstore.yaml
// API: Swagger Petstore v1.0.0

import axios from 'axios';
import UrlPattern from 'url-pattern';
import { z } from 'zod';

const pokemonName = z
  .string();

const pokemonType = z
  .object({
    name: z.string(),
    url: z.string(),
  })
  .strict()
  .catchall(z.any())
  .required();

const pokemon = z
  .object({
    id: z.number(),
    name: pokemonName,
    order: z.number(),
    types: z.array(
      z.object({
        slot: z.number(),
        type: pokemonType,
      })
    ),
  })
  .strict()
  .catchall(z.any())
  .required();

const schema = {
  pokemonName,
  pokemonType,
  pokemon,
};

const baseURL = 'https://pokeapi.co/api/v2';

async function getPokemonByName(name: z.infer<typeof schema.pokemonName>): Promise<z.infer<typeof schema.pokemon>> {
  try {
    const safePokemonName = schema.pokemonName.parse(name);

    const urlPattern = new UrlPattern('/pokemon/:name');

    const response = await axios<z.infer<typeof schema.pokemon>>({
      baseURL: baseURL,
      url: urlPattern.stringify({ name: safePokemonName }),
      method: 'get',
    });

    return schema.pokemon.parse(response.data);
  } catch (error) {
    if (error instanceof Error) {
      throw error;
    }

    throw new Error('Unknown error');
  }
}

const pokeAPI = {
  getPokemonByName,
};

async function test() {
  const { id, name, order, types } = await pokeAPI.getPokemonByName('pikachu');

  console.log(id, name, order, types);
}

void test();
